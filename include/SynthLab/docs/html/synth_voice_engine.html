<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: Engine &amp; Voice Programming</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('synth_voice_engine.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Engine &amp; Voice Programming </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>SynthLab includes two high-level objects that do not have base classes, and do not inherit from SythModule. The <b>SynthVoice</b> and <b>SynthEngine</b> allow you to combine the smaller SynthModule building blocks into a fully operational polyphonic software synthesizer. And, these two objects may be used alone, and without any of the SynthModules. You can use these two objects with your own synth components as well. The engine will decode incoming MIDI messages and deliver them to the voice which renders the notes. The engine mixes the output of the voice objects and adds master bus effects (if any), then ships the resulting audio back to the plugin framework. <br />
</p>
<h2>Big Picture </h2>
<p><b>The SynthVoice:</b></p><ul>
<li>creates and maintains a set of SynthModules that it intializes, sends MIDI messages to, and renders audio from</li>
<li>programs the modulation matrix (if used)</li>
<li>implements the audio-engine that moves audio data from the oscillators through filters and DCA in response to MIDI note-on and note-off messages</li>
<li>keeps track of the lifecycle of one MIDI note event, from the intial note-on, to the expiration of the amp EG controlling the time-domain output envelope</li>
<li>owns a SynthVoiceParameters structure that contains shared pointers to its SynthModule's shared parameter structures</li>
<li>this <b>SynthVoiceParameters structure is shared across all SynthVoice objects so that all of the identical SynthModules have instant access to the same set of parameters</b></li>
</ul>
<p><b>The SynthEngine:</b></p><ul>
<li>creates and maintains a set of SynthVoices that it intializes, sends MIDI messages to, and renders audio from</li>
<li>creates the MIDI, wavetable, and PCM sample databases that are shared across objects</li>
<li>creates the SynthVoiceParameters structure that all voices share</li>
<li>decodes MIDI events, stores CCs and other desired data in the shared MIDI input data array, and calls the note-on and note-off handler of the voice</li>
<li><b>is the sole interface object for the plugin framework; your processor object only needs to instantiate and communicate wiht a single SynthEngine object to render a complete software synth</b></li>
</ul>
<p>So, the SynthVoice renders audio from note events and the SynthEngine maintains the voices, acts as the centralized hub for shared data, and interfaces with plugin framework.</p>
<h2>SynthEngine </h2>
<p>The SynthEngine is designed to be a single object that encapsulates a complete synth. Typically, there is one and only one SynthEngine per synth project, but there is no reason you can't have more than one for a multiple-synth product. Your plugin framework use it to render audio output blocks, which the framework then ships out to the DAW. In SynthLab, the engine creates and maintins a set of SynthVoice objects, but that is optional and you may use the engine on its own, without the voice objects. <br />
</p>
<p>Figure 1 shows how the SynthEngine interfaces with your plugin framework's processing object. Notice that the SynthEngine has a similar but smaller set of opertional phases and functions as the SynthModules and SynthCores from the other sections of the programming guide.</p><ol type="1">
<li>plugin load/initialization</li>
<li>GUI update</li>
<li>audio render</li>
</ol>
<p><br />
 </p><div class="image">
<img src="engine_2.png" alt="engine_2.png"/>
</div>
<p> <br />
</p>
<p>Figure 1: the SynthEngine with relationship to the plugin framework object that owns/controls it <br />
</p>
<p>The SynthEngine object in the SDK is setup with some basic functionality:</p><ul>
<li>accept and decode MIDI messages</li>
<li>accept a block of empty buffers from the framework</li>
<li>mix together outputs of voice objects (they do NOT need to be SynthVoice objects)</li>
<li>apply FX if needed</li>
<li>return the rendered audio buffers to the framework.</li>
</ul>
<h2>SynthVoice </h2>
<p>If you worked through the MinSynth C++ object in the Standalone Programming Guide, then you already have a good feel for the SynthVoice is designed to operate. The MinSynth C++ object held a collection of SynthModules, reset them, sent them MIDI events, and called the render() method on them. It also moved audio data between the oscillator's output buffer and the filter's input buffer. The SynthVoice object is designed with a similar set of functional goals. First, it contains instances of each of the SynthModules in its architecture. Secondly, it mainpulates and controls these SynthModules to follow the operational phases for a software synth as outlined and detailed in the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>. These phases can be condensed down to three basic functions:</p><ol type="1">
<li>Initialization: the voice calls the module's reset function</li>
<li>Note-on and Note-off: the voice calls the doNoteOn and doNoteOff methods on its set of modules</li>
<li>Controlling Audio Signal Flow: the voice calls the module's update and render functions during each block processing cycle, and delivers the rendered audio back to the engine</li>
</ol>
<h2>SynthEngine and SynthVoice </h2>
<p>The SynthEngine and one or more SynthVoice objects can be combined together to create a complete operational synth, using the theory and design methods from the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>. Figure 2 shows how a set of simple synth voices are combined with the SynthEngine to allow for the efficient and safe sharing of MIDI data, wavetable and PCM sample data, and GUI parameters. Note that the theory is deep and explained fully in the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> so it will not be repeated here. You may use the example synth projects, which only differ in the SynthVoice object and GUIs, as a basis for deeper understanding in absence of the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>. <br />
</p>
<p>In addition to managing the components, decoding MIDI messages and rendering the audio, the engine and voice objects play a critical role in sharing MIDI, wavetable, PCM sample, and GUI parameters across the arrays of objects that are fundamentally identical and respond identically to the GUI control changes. This sharing scheme involves <b>std::shared_ptrs</b> in the engine and voice parameter structures, which are <b>distributed across the SynthComponent objects at creation time.</b> Note that all objects implement a getParameter() method to obtain a pointer to the shared parameters. <br />
</p>
<p>Figure 2.3 from the book is shown below that depicts a Voice object that contains one LFO, EG, oscillator, filter and DCA (the same as the MinSynth C++ object from the Standalone Programming Guide). You can see that the relationship between the engine and voice parameters allows the sharing of GUI control information across the voices and their SynthModule components.</p>
<p><br />
 </p><div class="image">
<img src="engine_3.png" alt="engine_3.png"/>
</div>
<p> <br />
</p>
<p>Figure 2.3: (a) the engine owns a stack of voice objects (four in this example, but 16 in the SynthLab projects) each of which includes an identical set of LFO, filter, EG, oscillator and DCA objects (b) the engine owns a voice parameter structure that is shared across these voices and (c) the shared voice parameters structure consists of a set of shared module parameter structures</p>
<p>The following sections will give you more information on these high level objects. Notice that they are already set up with virtual functions so you may use them as base classes for your variations.</p>
<p><b>Voice/Engine Guide</b></p><ul>
<li><a class="el" href="the_params.html">Updating GUI Parameters</a></li>
<li><a class="el" href="the_block.html">Block Audio Processing</a></li>
<li><a class="el" href="the_m_i_d_i.html">Enqueueing MIDI Events</a></li>
<li><a class="el" href="the_voice.html">SynthVoice</a></li>
<li><a class="el" href="the_engine.html">SynthEngine</a></li>
</ul>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
