<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: Creating SynthLab-DM Modules</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('synth_lab_d_m.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Creating SynthLab-DM Modules </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>What is a DM Module? </h2>
<p>SynthLab-DM modules are <b>plugins within a plugin</b> and are separate DLLs that you write, compile, and that the SynthLab-DM synths will load at runtime. You place the DLL (Windows) or dylib (MacOS) into a special folder in the same directory with your plugins, whether they are AU, VST3 or RAFX. <b>You only need to compile a single DLL or dylib for each OS</b>. The same dylib will load into AU or VST synths on MacOS and the x64 DLL will load into VST3 and the x86 DLL into RAFX synths in Windows. In the image below, you can see the choice of cores for the wavetable synth. Each object may expose up to 4 module cores. You may design and replace one, two, or every core in the synth, making a very personalized version for yourself. <b>This gives you the flexibility of modular synth programming and the nearly instant reward in testing</b> - each of the SynthLab-DM variants is a hybrid modular/semi-modular synth (or a <b>demi-modular synth</b>). <br />
</p>
<p><br />
 </p><div class="image">
<img src="SL_Promo_DM2.png" alt="SL_Promo_DM2.png"/>
</div>
<p> <br />
</p>
<p>In order to use the SynthLab products in DM-mode, you will need to build the initial set of DM modules on your target system. I have made this as simple as I can by providing you with Visual Studio and Xcode projects that have all 18 module sub-projects aggregated into them. This lets you build all the modules, in debug or release mode, with a single "build solution" operation. Details are below. <br />
</p>
<p><b>NOTE:</b> the DM modules built in Debug mode will run significantly slower than their Release configuration counterparts. This is by design and how debug configurations operate due to added overhead used at runtime. <b>When you build the initial set of DM modules, you should use the Release configuration (Visual Studio) or Product -&gt; Build For -&gt; Profiling in Xcode in order to achieve the intended CPU efficiency</b>, which is between 0.7% and 2.3% per note event, depending on the algorithm and modulation. You will easily acheive 16 notes of polyphony without maxing out the CPU thread slice in Release mode, but only 4-8 notes in Debug mode! <br />
</p>
<h2>DM Modules are DLL-Packaged ModuleCore Objects </h2>
<p>The best part about this is that if you've followed the tutorial and have learned to write a ModuleCore object, then you already know everything you need to know and better yet &ndash; <b>the exact same code you wrote for the ModuleCores is used in the SynthLab-DM modules, verbatim</b>. The only difference is that these ModuleCore objects are compiled as a separate project and loaded dynamically into the SynthLab-DM synths. You can use the DM synths as the testing clients and actively debug your code. This lets you design, build and test your module ideas with ultra-lean ultra-tiny compiler projects. <br />
</p>
<p>In these sections, you will learn how to setup the Visual Studio and Xcode projects to genrate the dynamic libraries. Each project will generate one ModuleCore DLL or dylib and will use one set of source files for each ModuleCore project. You can create new ModuleCores within the new project, or you can re-package existing ModuleCore objects; remember there is no difference in the code. So there is no new theory here regarding the modules or cores since this is a simple re-packaging of the ModuleCore requiring zero integration code.</p>
<h2>SynthLab-DM SDK Folders </h2>
<p>The SDK has a dedicated folder just for DM development shown below. It includes a subfolder named <b>sdk_files</b> that contains duplicates of some (but not all) of the files from the SDK's <b>source</b> folder. The reason for the duplicates is that when you code DM modules, you must adhere to the same C++ objects and interfaces that the DM synths were built with &ndash; this is part of the contract that all plugin APIs require and the DM modules are actually tiny plugins that are loaded at run-time. Since it is highly likely you will want to modify some (or many) of the SynthLab source objects to match your own design paradigms (or your company's), these are isolated from the others and should not be modified. The example Visual Studio and Xcode projects all reference these files.</p>
<p><br />
 </p><div class="image">
<img src="dmdev_0.png" alt="dmdev_0.png"/>
</div>
<p> <br />
</p>
<p>There are six subfolders: <br />
 <b>dll_support_files</b>: contains a pair of files that implement the DLL's exported entry point functions; these are used identically across the projects, but need to be paired with their corresponding synthlabcore.h and .cpp files for each project; these two files contain both MacOS and Windows code together.</p>
<p><br />
 </p><div class="image">
<img src="dmdev_1.png" alt="dmdev_1.png"/>
</div>
<p> <br />
</p>
<p><b>dm_modules</b>: this is where the DLLs/dylibs for all 18 modules for Windows and MacOS will be built when you use either the individual or aggregate projects(these are all x64); note that the x86 folder is only for RackAFX users who want to use that software for development and testing; these are combined in the SynthLabModules folder that will be copied into your plugin binaries folder (the location of your VST3 and AU plugins). See <a class="el" href="installing_d_m.html">Installing the SynthLab Plugins</a> for the details.</p>
<p><br />
 </p><div class="image">
<img src="dmdev_2.png" alt="dmdev_2.png"/>
</div>
<p> <br />
</p>
<p>Notice the two folders, one for Windows and the other for MacOS; these contain subfolders, one for each type of module, and inside of these are where your DLLs (Windows) and dylib (MacOS) files will be deposited after building. There is another folder named spare_modules where you may stash modules while you play with the different combinations. The DrumWT DLL/dylib files are in stashed away in here and are preset with a preferred index of 3 (last of the set). This is what your folders will look like after you have build the initial set of DM modules.</p>
<p><br />
 </p><div class="image">
<img src="dmdev_3.png" alt="dmdev_3.png"/>
</div>
<p> <br />
</p>
<p><b>dm_projects</b>: contains DM projects for <b>every module core in the SynthLab SDK</b>, each with its own folder</p>
<p><br />
 </p><div class="image">
<img src="dmdev_4.png" alt="dmdev_4.png"/>
</div>
<p> <br />
</p>
<p>Each of the example modules includes pre-made Visual Studio and Xcode project solutions; use these if you want to examine or work on only one DM Module project at a time</p>
<p><br />
 </p><div class="image">
<img src="dmdev_5.png" alt="dmdev_5.png"/>
</div>
<p> <br />
</p>
<p><b>sdk_files</b>: contains duplicates of some of the SDK files; the example Visual Studio and Xcode projects reference <em>these</em> files and not the <b>SynthLab_SDK/source</b> versions</p>
<p><b>vs_windows</b>: contains a Visual Studio 2017 solution that aggregates all 18 module projects together into one VS solution; if you are using a newer version, just open and accept the message about retargeting the solution __SynthLab-DM modules may be built with any version of Visual Studio from VS2017 and upwards, and in any congifuration (debug or release)</p>
<p><b>xcode_mac</b>: contains an Xcode project that aggregates all 18 module targets together into one combined project; if you are using a newer version, just open and accept the message about retargeting the solution __SynthLab-DM modules may be built with any version of Xcode from version 8.3 and upward, and in any congifuration (debug or release)</p>
<p>Here is what these aggregate solutions look like in Visual Studio and Xcode. Note that in both cases, they are accessing and working with the individual projects, so changes made in the aggregate solutions will propagate to the individual solutions as well.</p>
<p><br />
 </p><div class="image">
<img src="dmdev_6.png" alt="dmdev_6.png"/>
</div>
<p> <br />
</p>
<p><b>Remember:</b> the DM modules built in Debug mode will run significantly slower than their Release configuration counterparts. This is by design and how debug configurations operate due to added overhead used at runtime. <b>When you build the initial set of DM modules, you should use the Release configuration (Visual Studio) or Product -&gt; Build For -&gt; Profiling in Xcode in order to achieve the intended CPU efficiency</b>, which is between 0.7% and 2.3% per note event, depending on the algorithm and modulation. You will easily acheive 16 notes of polyphony without maxing out the CPU thread slice in Release mode, but only 4-8 notes in Debug mode! <br />
</p>
<h2>SynthLab-DM Examples </h2>
<p>Each example core contains a <b>source</b> folder with the four files needed:</p><ul>
<li>synthlabcore.h and .cpp: these are the C++ ModuleCore object that will be exported in the DLL</li>
<li>synthlabdll.h and .cpp: includes both Windows and MacOS code for exporting the creation function to the host DM synth</li>
</ul>
<p>For every example, the synthlabcore.h and .cpp files are actually identical copies of their SDK <b>ModuleCore</b> counterparts, but with the C++ object renamed to <b>SynthLabCore</b>. This makes all of the core projects identical such that the DLL support files do not need to be modified unless you decide to change the object names or make deeper customizations &ndash; note that these changes won't affect the DLL itself and that the C++ class names have nothing to do with the module names, which are set in the constructor.</p>
<p><br />
 </p><div class="image">
<img src="dmdev_7.png" alt="dmdev_7.png"/>
</div>
<p> <br />
</p>
<h2>SynthLab-DM DLL/dylib Locations </h2>
<p>After you sucessfully compile a DM module you will have a tiny DLL or dylib file as a result. This file packages a single, dynamically loadable <b>ModuleCore</b> object and a pre-determined entry point function for the SynthLab-DM synth to load. To keep everything "in the SDK" the DM solutions create local output files, but then copy them into the SDK's appropriate folder inside of: <br />
</p>
<p>SynthLabModules/x64/&lt;&lt;OS&gt;&gt;/&lt;&lt;module type&gt;=""&gt;&gt;</p>
<p>For example, the oscillators will be copied into the OS-specific folder here:</p>
<p><br />
 </p><div class="image">
<img src="dmdev_3.png" alt="dmdev_3.png"/>
</div>
<p> <br />
</p>
<p>The copying is implelmented as a Post Build Rule in both VS and Xcode. It ensures that you have both a local version and a copied version into that folder. Your version has the same folder structure as the final version that will reside in your AU, VST3 or RAFX plugin folder along side the rest of the plugins. In the beginning, you will probably want to just copy the DLL or dylib file into the appropriate folder. And, using the aggregate solutions allows you to rebuild all the modules at once, setting you up with a <b>fresh and new</b> SynthLabModules folder. Once you've done this a few times you can modify your Visual Studio or Xcode project to copy the files into the "real" destinations in succession. <br />
</p>
<p>The location of your plugins and the acompanying <b>SynthLabModules</b> folder are based on the OS and plugin type, listed here and shown in relationship to their plugin binaries in the figure that follows:</p><ul>
<li><b>AU MacOS</b>: /Library/Audio/Plug-Ins/Components/</li>
<li><b>VST3 MacOS</b>: /Library/Audio/Plug-Ins/VST3/</li>
<li><b>VST3 Windows</b>: C:/Program Files/Common Files/VST3/</li>
<li><b>RAFX Windows</b>: C:/Users/_your account_/AppData/Roaming/RackAFX 7.0/PlugIns/</li>
</ul>
<p><br />
 </p><div class="image">
<img src="dmdev_8.png" alt="dmdev_8.png"/>
</div>
<p> <br />
</p>
<p><b>SynthLab-DM DLL Parsing</b> <br />
 Synthlab-DM synths will find the <b>SynthLabModules</b> folder and itereate through each subfolder, instantiating the ModuleCores and adding them to their proper destinations; <b>LFO_MODULE</b> stamped modules will be added to the <b>SynthLFO</b> modules while FILTER_MODULES will be added to the <b>SynthFilter modules</b>, in each case as new member cores. Once all four cores have been filled for a given type, then it will reject any added cores. If you are developing a bunch of cores of the same kind, make sure you pick and choose only the cores you want to load and work with. You may need to temporarily re-locate some DM cores to the stash folder. Notice also that the pre-compiled cores have their own preferred index location. Since you have all the code and the same project I used, then you may change that index value. The file iterators go through the folders alphabetically, so if your module isn't showing up, or is in the wrong core slot, check the folders and make sure you have only the DLL or dylib files you need; you may always use the the spare_modules folder as a temporary location.</p>
<p><b>MacOS Gatekeeper</b> <br />
 With each new OS, the MacOS Gatekeeper becomes more restrictive and prohibitive with regards to using products without the dreaded message telling you the product can't be opened because it is from an un-trusted source. I have code-signed the MacOS plugins and signed and notarized the installer so you should not have an issue with the synths. If you examine the DLL support files, you will see that I use the <b>dlopen</b> function to load the DM modules. According to the Apple documentation here: <a href="https://developer.apple.com/library/archive/technotes/tn2206/_index.html">https://developer.apple.com/library/archive/technotes/tn2206/_index.html</a> the Gatekeeper "does not apply to libraries the app loads itself using the dlopen function" so in theory you should not have issues. If you do (because Apple changes something in the future) then you may need to use the Security &amp; Privacy firewall to manually accept opening these DLLs when you load a synth. This is one of the reasons you must build the DM modules yourself. I have never had an issue loading the DM DLLs on my own system (Catalina and Big Sur). <b>However, Apple has as reputation of breaking existing OS paradigms on practically each new OS release</b> so in the future, these dylib files may need to be relocated to a system folder, and the SynthLab DM products will need to be rebuilt on my end. <br />
</p>
<p><b>SynthLabCore Object</b> <br />
 You already know that the DM module is just a special re-packaging of a ModuleCore object. To simplify the coding as much as possible, <b>the two extra files that handle the DLL or dylib aspects will attempt to create a ModuleCore with the class name SynthLabCore</b> that is packaged in the two DM core files named <b>synthlabcore.h</b> and <b>synthlabcore.cpp</b> which are identical to the same named files in the SDK. Notice that SynthLab-DM does not categorize your DM module based on its class name; not only can you name the class as you wish, but if you like you may use the same name for every class. The only thing that matter is that the actual DLL or dylib filename is unique so that you may plant them together in the same folder. <br />
</p>
<h2>Starting a New Project </h2>
<p>If you are beginning a brand new DM project from scratch, then you just need to make sure to code your ModuleCore into the two <b>synthlabcore</b> source files and with that object name. The DLL/dylib export code will instantiate and serve SynthLabCore objects to the DM host.</p>
<p><b>Re-Packaging an Existing ModuleCore</b> <br />
 If you are going to re-package an existing ModuleCore as a DM module then you have three immediate options:</p><ol type="1">
<li>take your ModuleCore and rename its class to <b>SynthLabCore</b> and package that in the existing <b>synthlabcore.h</b> and <b>synthlabcore.cpp</b> files</li>
<li>take your ModuleCore and rename its class to <b>SynthLabCore</b> and package that in the whatever source code names you like, then add these files to your DM project to replace the existing <b>synthlabcore.h</b> and <b>synthlabcore.cpp</b> files</li>
<li>leave the ModuleCore class name alone and modify the <b>synthlabdll.cpp</b> file to instantiate your new class name</li>
</ol>
<p>If you are new to SynthLab or to DLL projects in general, you may want to use 1. or 2. above as they are guaranteed to produce the proper object at DM runtime. If you want to keep your ModuleCore with the same class name, regardless of how you package the source files, you will need to modify the DLL export code.</p>
<p><b>Modify DLL Export Code</b> <br />
 You can modify the code for both Windows and MacOS at the same time since the edits are minimal. <br />
</p>
<p>If you are using ModuleCore source files that are NOT named <b>synthlabcore.h</b> and <b>synthlabcore.cpp</b>:</p><ul>
<li>open the <b>synthlab.cpp</b> file</li>
<li>change the #include statement at the top to #include your ModuleCore.h file rather than synthlabcore.h</li>
</ul>
<p>Inside of <b>synthlabdll.cpp</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// --- function defs</span></div><div class="line"><span class="preprocessor">#include &quot;synthlabdll.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// --- this is the file containing your ModuleCore object for DM exporting</span></div><div class="line"><span class="comment">// #include &quot;synthlabcore.h&quot;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// --- changed to new file</span></div><div class="line"><span class="preprocessor">#include &quot;my_module_core.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// ---</span></div></div><!-- fragment --><p>Now you can change the two functions, one for Windows and one for MacOS, that instantiate and deliver the ModuleCore pointer.</p><ul>
<li>alter the code to instantiate your object rather than the SynthLabCore object:</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// --- Windows</span></div><div class="line">DllExport <a class="code" href="class_synth_lab_1_1_module_core.html">SynthLab::ModuleCore</a>* createModuleCore()</div><div class="line">{</div><div class="line">     <span class="comment">// --- removed SynthLabCore</span></div><div class="line">     <span class="comment">// SynthLab::ModuleCore* module = new SynthLab::SynthLabCore();</span></div><div class="line">     </div><div class="line">     <span class="comment">// --- replaced with MyModuleCore</span></div><div class="line">     <a class="code" href="class_synth_lab_1_1_module_core.html">SynthLab::ModuleCore</a>* module = <span class="keyword">new</span> SynthLab::MyModuleCore();</div><div class="line">     </div><div class="line">     <span class="keywordflow">return</span> module;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// --- MacOS </span></div><div class="line"><a class="code" href="class_synth_lab_1_1_module_core.html">SynthLab::ModuleCore</a>* createModuleCore()</div><div class="line">{</div><div class="line">     <span class="comment">// --- removed SynthLabCore</span></div><div class="line">     <span class="comment">// SynthLab::ModuleCore* module = new SynthLab::SynthLabCore();</span></div><div class="line">    </div><div class="line">     <span class="comment">// --- replaced with MyModuleCore</span></div><div class="line">     <a class="code" href="class_synth_lab_1_1_module_core.html">SynthLab::ModuleCore</a>* module = <span class="keyword">new</span> SynthLab::MyModuleCore();</div><div class="line"></div><div class="line">     <span class="keywordflow">return</span> module;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ---</span></div></div><!-- fragment --><p>At this point, gather your ModuleCore source files and pick the target OS. You will be creating Visual Studio and Xcode projects that are tiny and simple but be sure to follow the process exactly when you are starting out.</p>
<p><b>SynthLab-DM Programming Guide</b></p><ul>
<li><a class="el" href="config_t_x_t.html">The config.txt File</a></li>
<li><a class="el" href="synth_lab_d_m_win.html">SynthLab-DM Windows</a></li>
<li><a class="el" href="synth_lab_d_m_mac.html">SynthLab-DM MacOS</a></li>
</ul>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
