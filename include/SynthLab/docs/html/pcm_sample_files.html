<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: PCM Sample Files &amp; Database</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pcm_sample_files.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PCM Sample Files &amp; Database </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b>SynthLabSamples</b> folder includes all of the PCM samples used in the <b>SynthLab-PCM</b> project, packaged as "patches" in individual folders that are inside of the containing folder for the synth. The platform independent <b>PCMSample</b> object opens the WAV files and extracts their audio guts into dynamically alloted arrays for instant playback within the synth. This object needs to know the path to the files it opens. The SynthLab example PCM files are stored in folders whose names are used on the GUI (there is no real dependency for this, it is only for easier reading/understanding in the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>).</p>
<p><br />
 </p><div class="image">
<img src="pcm_1.png" alt="pcm_1.png"/>
</div>
<p> <br />
</p>
<h2>PCM Sample Folder Location </h2>
<p>You have numerous options when packaging your sample based synth for the user and if you can build a Windows or Mac installer, then you have a good idea for the permitted locations of these files. One thing to avoid is packaging them within the plugin bundle itself. The <b>SynthLab-PCM</b> oscillators are coded to find their samples in a specially named folder that is fixed relative to the plugin binary itself. The <b>SynthLabSamples</b> folder resides in the same folder as the plugin bundles. For example: <br />
</p>
<p><b>Windows VST3</b>: C:/Program Files/Common Files/VST3 <br />
 <b>MacOS AU</b>: /Library/Audio/Plug-Ins/Components/ <br />
 <b>MacOS VST3</b>: /Library/Audio/Plug-Ins/VST3/ <br />
 <br />
</p>
<p>The SynthLab-PCM oscillators rely on the engine to relay back the location of this folder, that the plugin itself can request from the framework or from the OS directly. Both Windows and MacOS have standardized ways of obtaining this path from within the plugin. <br />
</p>
<p>However, you may also hardcode this path into the oscillator cores (see the reset( ) function), have the core read the location from a specified file, or some other safe method of generating the path to the folder. See the core example files for more details. <br />
</p>
<h2>Folders </h2>
<p>The PCM samples are organized in multi-sets that reside in folders. The oscillators know the names of these folders that they either append to the DLL path from the host, or that they have apriori knowledge of the location. The included sample sets consist of:</p><ul>
<li><b>legacy</b>: a set of 16 multi-sets for various bass patches, culled from the 1st edition <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> and appearing for free in FutureMusic magazine</li>
<li><b>mellotron</b>: a set of the 10 patches from the Mellotron instrument in long (7-10 second) loops from <a href="https://sonicbloom.net/en/free-sb-mellotron-samples/" target="_blank">sonic-bloom</a></li>
<li><b>waveslices</b>: a bank of 4 sets of PCM samples sliced from a variety of sources using <a href="https://aubio.org//" target="_blank">aubio</a></li>
<li><b>drumloops</b>: files that loop from beginning to end (used for homework in the book)</li>
<li><b>gravity</b>: a set of wave slices made with <a href="https://aubio.org//" target="_blank">aubio</a> (used for homework in the book)</li>
</ul>
<h2>IPCMSampleDatabase </h2>
<p>The PCM sample oscillator and its cores access the sample information from a shared object that implements the <b>IPCMSampleDatabase</b> interface. This interface is platform independent and framework/API agnostic. The database object provides a simple set of functions for querying, adding and removing PCM sample sets. The objects that use the database do not know any details of how the database stores its information, or whether the samples came from WAV files or not. <br />
</p>
<p>During initialization, the PCM sample oscillator cores will perform the following steps on the database at initialization time:</p><ul>
<li>checking the database to see if a PCM sample exists; the PCM samples are identified with <b>unique</b> PCM sample strings that will be connected to a GUI control that likewise will need to expose unique strings to the user</li>
<li>adding PCM samples to the database if they don't exist; PCM sample objects implement the IPCMSource interface, which is used for storing and reading the PCM data</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// --- comments removed</span></div><div class="line"><span class="keyword">class </span>IPCMSampleDatabase</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> IPCMSampleSource* getSampleSource(<span class="keyword">const</span> <span class="keywordtype">char</span>* uniqueSampleSetName) = 0;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> addSampleSource(<span class="keyword">const</span> <span class="keywordtype">char</span>* uniqueSampleSetName, IPCMSampleSource* sampleSource) = 0;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> removeSampleSource(<span class="keyword">const</span> <span class="keywordtype">char</span>* uniqueSampleSetName) = 0;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> clearSampleSources() = 0;</div><div class="line">};<span class="comment">//</span></div></div><!-- fragment --><h2>IPCMSampleSource </h2>
<p>A set of sample arrays are contained within a single object that implements the <b>IPCMSampleSource</b> interface. This interface is used during the oscillator updating and rendering phases. During note event rendering, these oscillator cores will then use the database and:</p><ul>
<li>select a PCM sample set based on the user's choice (if it has changed while the note is held, or if this is a new note event); the database returns an IPCMSampleSource pointer</li>
<li>select a particular PCM sample array from the set based on the oscillator's current pitch, including modulation sources and GUI manipulation; the IPCMSampleSource::selectSample( ) method is used</li>
<li>asks the IPCMSampleSource for a sample at a particular location within the array (including interpolation if used) to fill its output buffer with data</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// --- most comments removed</span></div><div class="line"><span class="keyword">class </span>IPCMSampleSource</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> selectSample(<span class="keywordtype">double</span> oscFrequency) = 0;</div><div class="line">    <span class="keyword">virtual</span> PCMSampleOutput readSample(<span class="keywordtype">double</span>&amp; readIndex, <span class="keywordtype">double</span> inc) = 0;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> setSampleLoopMode(<a class="code" href="group___constants-_enums.html#gabb8848e63c439708b0862dc8b8fd83f3">SampleLoopMode</a> _loopMode) = 0;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> deleteSamples() = 0;</div><div class="line">    <span class="keyword">virtual</span> uint32_t getValidSampleCount() = 0; <span class="comment">// not used in SynthLab, but available</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> haveValidSamples() = 0;</div><div class="line">};</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>The figure here shows how the interface isolates the implementation details and hides them from the SynthModule or ModuleCore object that accesses them via the <b>IPCMSampleSource</b> interface functions. Two possible internals are shown and include:</p><ol type="1">
<li>accessing and pre-loading the multi-sample WAV files at startup into data-arrays (or a data-brick, if desired); this is how the SynthLab example objects work</li>
<li><p class="startli">setting up a worker thread and accessing tables from disk <b>at run-time as notes are triggered</b>; this is quite complex and will certianly be programmer or company-centric in nature &ndash; note that there are numerous US patents involved in sample-based syntgesis; start your journey here: <a href="https://patents.justia.com/assignee/invision-interactive-inc">https://patents.justia.com/assignee/invision-interactive-inc</a></p>
<p class="startli"><br />
 </p><div class="image">
<img src="pcm_2.png" alt="pcm_2.png"/>
</div>
<p> <br />
</p>
</li>
</ol>
<p>SynthLab includes only one <b>SynthLabPCMSource</b> object that demonstrates how to create a sample source object and exposes <b>IPCMSampleSource</b> using the <b>PCMSample</b> and <b>WaveFolder</b> objects to find, parse, and store audio samples extracted from the WAV files. Figure 11.2 (from my <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>) shows the Mellotron sample set folder hierarchy with each patch stored as a folder of WAV files.</p>
<p><br />
 </p><div class="image">
<img src="synthlab_IPCM_1.png" alt="synthlab_IPCM_1.png"/>
</div>
<p> <br />
</p>
<p>Figure 11.2: the Mellotron core directory contains subdirectories for each patch which in turn contain a set of wave files; each of these is extracted into a PCMSample object and stored in an array of pointers in an IPCMSampleSource object <br />
 <br />
</p>
<p>During extraction, each WAV file's audio data is stored in a PCMSample object. The SynthLabPCMSource object stores an array of pointers to these PCMSample objects. Connecting objects use the IPCMSampleSource interface functions to read and interpolate the arrays. As with the wavetable paradigm, none of the oscillators nor cores knows or needs to know informaiton about the samples. They are simply fed sample data when they request it. Figure 11.3 shows how the PCM sample database conceptually organizes the PCM sources according to unique names and how the samples for the Mellotron and Legacy files are distributed across the keyboard.</p>
<p><br />
 </p><div class="image">
<img src="synthlab_IPCM_2.png" alt="synthlab_IPCM_2.png"/>
</div>
<p> <br />
</p>
<p>Figure 11.3: (a) the sample sources are arranged in a database and accessed via a unique name string (b) the shaded keys show the included wave files for the Mellotron, sampled on every note from G2 through F5 while the (c) legacy files include samples on minor third boundaries from A1 through C4 <br />
 <br />
</p>
<p><b>This paradigm allows you to write two C++ objects (one for the database and one for the PCM sample source) that expose the two interfaces above and then you can connect them directly with the synth engine, which shares the IPCMSampleDatabase with its voice objects, who share them with their oscillators.</b></p>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
