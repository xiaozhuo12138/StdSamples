<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: Oscillator Pitch Modulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pitch_mod.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Oscillator Pitch Modulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Now you can add the code to do the pitch modulation in the new additive oscillator's update() function. There are multiple pitch modultion sources and a couple of different ways of handling the modulation functions. The setup below follows the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> and uses the same modulation array input slots as the other oscillators in SynthLab. It also uses the same GUI parameter controls as discussed in the book and these documents. You can find very similar code througout the oscillator cores and you can find different mechanisms for manipulating the rendered waveforms including shape (phase distortion) and hard sync. Also note that each SynthLab oscillator has a special modulation called the "Unique Modulation" and these vary a bit with the type of oscillator. Reading and digesting these other object's example code will help you see how to do more modulations &ndash; and of course the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> is highly recommended. <br />
</p>
<p>All SynthLab oscillators implement an update function that is nearly identical because the majority of the function involves pitch modulation. The pitch shift calculation creates a scalar value that you multiply with the MIDI note pitch value in Hz. Chapter 6 in the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> contains the modulation equation and explains the theory. SynthLab pitched oscillators have numerous pitch shift sources that will need to be applied together. <br />
</p>
<p>Pitched oscillators expose the following GUI controls and modulation inputs via the parameters structure: <br />
 <b>GUI Controls</b></p><ul>
<li>octaveDetune</li>
<li>coarseDetune (semitones)</li>
<li>fineDetune (cents)</li>
<li>unisonDetune (cents)</li>
</ul>
<p><b>Modulation</b></p><ul>
<li>bipolar pitch modulation (vibrato)</li>
<li>glide modulation (portamento)</li>
<li>MIDI pitch bend</li>
<li>Global Tuning</li>
</ul>
<p>Here is the new update function that implements the moduation and that you may use for pitch modulation; test it with your MinSynth voice or within your own test project.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> AddOscCore::update(CoreProcData&amp; processInfo)</div><div class="line">{</div><div class="line">     <span class="comment">// --- Get Parameters (will use in next module)</span></div><div class="line">     <span class="comment">//</span></div><div class="line">     OscParameters* parameters = <span class="keyword">static_cast&lt;</span>OscParameters*<span class="keyword">&gt;</span>(processInfo.moduleParameters);</div><div class="line"></div><div class="line">     <span class="comment">// --- UPDATE OPERATIONS HERE</span></div><div class="line">     <span class="comment">// --- get the pitch bend value in semitones</span></div><div class="line">     <span class="keywordtype">double</span> midiPitchBend = <a class="code" href="group___synth_functions.html#ga8b656208edc2828021d48238700bf1f8">calculatePitchBend</a>(processInfo.midiInputData);</div><div class="line"></div><div class="line">     <span class="comment">// --- get the master tuning multiplier in semitones</span></div><div class="line">     <span class="keywordtype">double</span> masterTuning = <a class="code" href="group___m_i_d_i_functions.html#gae374b274d7fe82182de799ced0af1ce2">calculateMasterTuning</a>(processInfo.midiInputData);</div><div class="line"></div><div class="line">     <span class="comment">// --- calculate combined tuning offsets by simply adding values in semitones</span></div><div class="line">     <span class="keywordtype">double</span> freqMod = processInfo.modulationInputs-&gt;getModValue(kBipolarMod) * <a class="code" href="group___constants-_enums.html#ga503a00d259976e530717adc9eefe4852">kOscBipolarModRangeSemitones</a>;</div><div class="line"></div><div class="line">     <span class="comment">// --- do the portamento</span></div><div class="line">     <span class="keywordtype">double</span> glideMod = glideModulator-&gt;getNextModulationValue();</div><div class="line"></div><div class="line">     <span class="comment">// --- calculate combined tuning offsets by simply adding values in semitones</span></div><div class="line">     <span class="keywordtype">double</span> currentPitchModSemitones = glideMod +</div><div class="line">               freqMod +</div><div class="line">               midiPitchBend +</div><div class="line">               masterTuning +</div><div class="line">               (parameters-&gt;oscSpecificDetune) +        <span class="comment">/* semitones */</span></div><div class="line">               (parameters-&gt;octaveDetune * 12) +        <span class="comment">/* octaves =  semitones*12 */</span></div><div class="line">               (parameters-&gt;coarseDetune) +             <span class="comment">/* semitones */</span></div><div class="line">               (parameters-&gt;fineDetune / 100.0) +       <span class="comment">/* cents/100 = semitones */</span></div><div class="line">               (processInfo.unisonDetuneCents / 100.0); <span class="comment">/* cents/100 = semitones */</span></div><div class="line"></div><div class="line">     <span class="comment">// --- lookup the pitch shift modifier (fraction)</span></div><div class="line">     <span class="comment">//double pitchShift = pitchShiftTableLookup(currentPitchModSemitones); &lt;--- commented out!</span></div><div class="line"></div><div class="line">     <span class="comment">// --- direct calculation version 2^(n/12) - note that this is equal temperatment</span></div><div class="line">     <span class="keywordtype">double</span> pitchShift = pow(2.0, currentPitchModSemitones / 12.0);</div><div class="line"></div><div class="line">     <span class="comment">// --- calculate the moduated pitch value</span></div><div class="line">     <span class="keywordtype">double</span> oscillatorFrequency = midiPitch*pitchShift;</div><div class="line"></div><div class="line">     <span class="comment">// --- BOUND the value to our range - in theory, we would bound this to any NYQUIST</span></div><div class="line">     <a class="code" href="group___synth_functions.html#gab5397b0e177e87c615ead68e8d0a3e9c">boundValue</a>(oscillatorFrequency, <a class="code" href="group___constants-_enums.html#gab43b6935b2187a508bc30446cb727548">OSC_FMIN</a>, <a class="code" href="group___constants-_enums.html#ga4a9b30b67beb68b3c79ae4ee1fa846bd">OSC_FMAX</a>);</div><div class="line"></div><div class="line">     <span class="comment">// --- phase inc = fo/fs this sets it</span></div><div class="line">     oscClock.setFrequency(oscillatorFrequency, sampleRate);</div><div class="line"></div><div class="line">     <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>Test your object again with pitch modulation from the LFO in MinSynth.</p>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="module_cores.html">ModuleCore Progamming</a></li><li class="navelem"><a class="el" href="create_osc.html">Create an Additive Oscillator Core</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
