<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: Enqueueing MIDI Events</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('the_m_i_d_i.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Enqueueing MIDI Events </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Your plugin framework will deliver a set of MIDI events with each incoming audio buffer during its audio buffer processing cycle. Typically these events are timestamped (from the host) with a buffer sample time value that aligns the MIDI events with samples in the audio buffer. Regardless of coding, your plugin framework will need to enqueue the MIDI messages for a particular block of audio data into the SynthProcessInfo struct prior to calling the SynthEngine's render() function. <br />
</p>
<p>The <b>SynthProcessInfo</b> struct stores a vector of midiEvents. This is one of two MIDI event structures, and is more generalized and more closely corresponds to raw MIDI data. The other <a class="el" href="ex_m_i_d_ievents.html">MIDI Note Events</a> structure is only for note-on and note-off messages and is used inside of the SynthEngine and SynthVoice objects. The code for this structure is below. <br />
</p>
<p>Things to note:</p><ul>
<li>the MIDI bytes are encoded into simple uint32_t datatypes</li>
<li>there is an additional non-MIDI data value <b>midiSampleOffset</b> that should arrive from your framework; <b>you will need to use this value to know which MIDI messages to send into the Engine for a given audio render block</b> however this value is NOT used during the audio block render process because of the way MIDI messages are decoded and handled at the top of the block processing function</li>
<li>use the specialized constructor to create the MIDI event in one line of code</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// --- general purpose MIDI event</span></div><div class="line"><span class="keyword">struct </span>midiEvent</div><div class="line">{</div><div class="line">     midiEvent() {}</div><div class="line">     midiEvent(uint32_t _midiMessage,</div><div class="line">               uint32_t _midiChannel,</div><div class="line">               uint32_t _midiData1,</div><div class="line">               uint32_t _midiData2,</div><div class="line">               uint32_t _midiSampleOffset = 0)</div><div class="line">     : midiMessage(_midiMessage)</div><div class="line">     , midiChannel(_midiChannel)</div><div class="line">     , midiData1(_midiData1)</div><div class="line">     , midiData2(_midiData2)</div><div class="line">     , midiSampleOffset(_midiSampleOffset) {}</div><div class="line"></div><div class="line">     midiEvent&amp; operator=(<span class="keyword">const</span> midiEvent&amp; data)</div><div class="line">     {</div><div class="line">          <span class="comment">// removed for brevity </span></div><div class="line">     }</div><div class="line"></div><div class="line">     uint32_t    midiMessage = 0;]      <span class="comment">// &lt; BYTE message as UINT</span></div><div class="line">     uint32_t    midiChannel = 0;       <span class="comment">// &lt; BYTE channel as UINT</span></div><div class="line">     uint32_t    midiData1 = 0;         <span class="comment">// &lt; BYTE data 1 as UINT</span></div><div class="line">     uint32_t    midiData2 = 0;         <span class="comment">// &lt; BYTE data 2 as UINT</span></div><div class="line">     uint32_t    midiSampleOffset = 0;  <span class="comment">// &lt; sample offset of midi event within audio buffer</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>For each MIDI message your framework delivers during a particular audio block, you enqueue the MIDI data with a helper function. So, your framework code will need to have a loop that pushes these events into the queue. In this example, the MIDI data is hardcoded, but it would normally come from your plugin framework's received MIDI messages.</p>
<div class="fragment"><div class="line"><span class="comment">// --- your plugin framework prepares this synthBlockProcInfo struct</span></div><div class="line"><a class="code" href="class_synth_lab_1_1_synth_process_info.html">SynthLab::SynthProcessInfo</a> synthBlockProcInfo; </div><div class="line"></div><div class="line"><span class="comment">// --- always clear out the events from the last audio block process</span></div><div class="line">synthBlockProcInfo.<a class="code" href="class_synth_lab_1_1_synth_process_info.html#acf3af6a93a225290d1a8ac4ca623cadb">clearMidiEvents</a>();</div><div class="line"></div><div class="line"><span class="comment">// --- parse MIDI events that occur during each audio block and create the event structure</span></div><div class="line"><a class="code" href="struct_synth_lab_1_1midi_event.html">SynthLab::midiEvent</a> synthEvent(NOTE_ON, <span class="comment">/* NOTE_ON is declared in synthconstants.h */</span></div><div class="line">                               0,       <span class="comment">/* Channel 0 (MIDI Channel 1) */</span></div><div class="line">                               60,      <span class="comment">/* midi note number, Middle C */</span></div><div class="line">                               127,     <span class="comment">/* velocity */</span></div><div class="line">                               0);      <span class="comment">/* buffer time, not used */</span></div><div class="line"></div><div class="line"><span class="comment">// --- and push structure into SynthProcessInfo, which adds them to its vector</span></div><div class="line">synthBlockProcInfo.<a class="code" href="class_synth_lab_1_1_synth_process_info.html#a04a05b4370103181b3821a68644b838a">pushMidiEvent</a>(synthEvent);</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>When the SynthEngine's render function returns, these MIDI events will still be intact, and unaltered. You may need to use them for some other MIDI processing so they are avaiable. Be sure to clear them out before enqueueing the next batch for the next audio block.</p>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="synth_voice_engine.html">Engine &amp; Voice Programming</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
