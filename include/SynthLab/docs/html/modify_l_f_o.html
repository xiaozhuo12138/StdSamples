<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: Modify the LFO Core</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('modify_l_f_o.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Modify the LFO Core </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We will modify the LFOCore object by adding a new waveform to it. The new waveform will be a clipped sinusoid whose top and bottom 1/4 waveform will be clipped off. You will learn how the SynthClock can be used to render trig functions in this simple tutorial.</p>
<p><br />
 </p><div class="image">
<img src="clipsine.png" alt="clipsine.png"/>
</div>
<p> <br />
</p>
<p>Figure 1: waveform of clipped-sine LFO</p>
<p><b>Constructor: Waveform Names</b> <br />
 Open the <a class="el" href="lfocore_8cpp.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">LFOCore.cpp</a> file and check out the constructor. Notice that only the first 10 (index 0 - 9) of the waveform strings are populated. We will add our clipped sine as the waveform indexed with 10. Note that the <b>empty_string.c_str()</b> produces the output "-----" which the user percieves as empty or non-existent.</p>
<div class="fragment"><div class="line">LFOCore::LFOCore()</div><div class="line">{</div><div class="line">     moduleType = <a class="code" href="group___constants-_enums.html#ga1c24f6a5b67a157f815e7251140d0558">LFO_MODULE</a>;</div><div class="line">     moduleName = <span class="stringliteral">&quot;ClassicLFO&quot;</span>;</div><div class="line">     lookupTables.reset(<span class="keyword">new</span>(BasicLookupTables));</div><div class="line"></div><div class="line">     <span class="comment">// --- our LFO waveforms //&quot;clip sine&quot;;// </span></div><div class="line">     <span class="comment">/*</span></div><div class="line"><span class="comment">     Module Strings, zero-indexed for your GUI Control:</span></div><div class="line"><span class="comment">          - triangle, sine ,ramp_up, ramp_dn, exp_up, exp_dn, exp_tri, square, rand_SH1, pluck</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     coreData.moduleStrings[0] = <span class="stringliteral">&quot;triangle&quot;</span>;     coreData.moduleStrings[8] =  <span class="stringliteral">&quot;rand S&amp;H1&quot;</span>;</div><div class="line">     coreData.moduleStrings[1] = <span class="stringliteral">&quot;sine&quot;</span>;         coreData.moduleStrings[9] =  <span class="stringliteral">&quot;pluck&quot;</span>;</div><div class="line">     coreData.moduleStrings[2] = <span class="stringliteral">&quot;ramp up&quot;</span>;      coreData.moduleStrings[10] = <span class="stringliteral">&quot;clip sine&quot;</span>; <span class="comment">//&lt;-- ADDED WAVEFORM slot 10</span></div><div class="line">     coreData.moduleStrings[3] = <span class="stringliteral">&quot;ramp dn&quot;</span>;      coreData.moduleStrings[11] = <a class="code" href="group___constants-_enums.html#ga80e76224a09d421e5865520315cb4d84">empty_string</a>.c_str();</div><div class="line">     coreData.moduleStrings[4] = <span class="stringliteral">&quot;exp up&quot;</span>;       coreData.moduleStrings[12] = <a class="code" href="group___constants-_enums.html#ga80e76224a09d421e5865520315cb4d84">empty_string</a>.c_str();</div><div class="line">     coreData.moduleStrings[5] = <span class="stringliteral">&quot;exp dn&quot;</span>;       coreData.moduleStrings[13] = <a class="code" href="group___constants-_enums.html#ga80e76224a09d421e5865520315cb4d84">empty_string</a>.c_str();</div><div class="line">     coreData.moduleStrings[6] = <span class="stringliteral">&quot;exp tri&quot;</span>;      coreData.moduleStrings[14] = <a class="code" href="group___constants-_enums.html#ga80e76224a09d421e5865520315cb4d84">empty_string</a>.c_str();</div><div class="line">     coreData.moduleStrings[7] = <span class="stringliteral">&quot;square&quot;</span>;       coreData.moduleStrings[15] = <a class="code" href="group___constants-_enums.html#ga80e76224a09d421e5865520315cb4d84">empty_string</a>.c_str();</div><div class="line"></div><div class="line">     <span class="comment">// --- modulation control knobs</span></div><div class="line">     coreData.modKnobStrings[MOD_KNOB_A] = <span class="stringliteral">&quot;Shape&quot;</span>;</div><div class="line">     coreData.modKnobStrings[MOD_KNOB_B] = <span class="stringliteral">&quot;Delay&quot;</span>;</div><div class="line">     coreData.modKnobStrings[MOD_KNOB_C] = <span class="stringliteral">&quot;FadeIn&quot;</span>;</div><div class="line">     coreData.modKnobStrings[MOD_KNOB_D] = <span class="stringliteral">&quot;BPM Sync&quot;</span>;</div><div class="line">}</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p><b>reset( )</b> <br />
 Check out the reset() function which initializes the object. Notice the lfoClock member (declared in the <a class="el" href="lfocore_8h.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">LFOCore.h</a> file) is reset here. This resets the modulo counter for operation (this is detailed in the Synth book). We'll be using the lfoClock's output value (a member named mcounter) shortly.</p>
<div class="fragment"><div class="line"><span class="comment">// --- reset clocks and timers</span></div><div class="line">lfoClock.reset(); <span class="comment">//&lt;-- reset the timebase</span></div><div class="line">sampleHoldTimer.resetTimer();</div><div class="line">delayTimer.resetTimer();</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p><b>update( )</b> <br />
 Move down to the update() function and notice what is fundamentally happening here - the user's parameter settings (from the GUI) and the modulator values are being combined to set the final oscillator frequency for the LFO. A piece of this function is below. Think about what you could change or modify for your own object.</p><ul>
<li>notice how the modulation input array's kFrequencyMod slot is accessed and the value used to alter the frequency that the user has set in the parameters structure</li>
<li>the newly calculated value is bounded on a range with the <a class="el" href="group___synth_functions.html#gab5397b0e177e87c615ead68e8d0a3e9c" title="Bound a value to min and max limits. ">boundValue()</a> function which is used throughout SynthLab</li>
<li>the lfoClock is updated with the new frequency</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// --- apply linear modulation</span></div><div class="line"><span class="keywordtype">double</span> modValue = processInfo.modulationInputs-&gt;getModValue(kFrequencyMod) * LFO_HALF_RANGE;</div><div class="line"></div><div class="line"><span class="comment">// --- apply linear modulation</span></div><div class="line"><span class="keywordtype">double</span> newFrequency_Hz = parameters-&gt;frequency_Hz + modValue;</div><div class="line"><a class="code" href="group___synth_functions.html#gab5397b0e177e87c615ead68e8d0a3e9c">boundValue</a>(newFrequency_Hz, <a class="code" href="group___constants-_enums.html#gadb9ee510bdb36270f130f7a5a2997760">LFO_FCMOD_MIN</a>, LFO_FCMOD_MAX);</div><div class="line"></div><div class="line"><span class="comment">// --- calculate the phase inc from the frequency</span></div><div class="line">lfoClock.setFrequency(newFrequency_Hz, sampleRate);</div></div><!-- fragment --><p><b>render( )</b> <br />
 The LFOCore::render operation is broken into three main code chunks. At the top, I work with the delay and fade-in timers and functions that either stave off or change the amplitude of the LFO output. Notice how I get the LFOParameter structure pointer at the top of the function. Watch for the code that enters the loop over the block of data to process <br />
</p>
<p><b>for (uint32_t i = 0; i &lt; processInfo.samplesToProcess; i++)</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> LFOCore::render(CoreProcData&amp; processInfo)</div><div class="line">{</div><div class="line">     <span class="comment">// --- parameters</span></div><div class="line">     LFOParameters* parameters = <span class="keyword">static_cast&lt;</span>LFOParameters*<span class="keyword">&gt;</span>(processInfo.moduleParameters);</div><div class="line"></div><div class="line">     <span class="comment">// --- one shot flag</span></div><div class="line">     <span class="keywordflow">if</span> (renderComplete) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"></div><div class="line">     <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; processInfo.samplesToProcess; i++)</div><div class="line">     {</div><div class="line">          <span class="comment">// --- delay timer</span></div><div class="line">          <span class="keywordflow">if</span> (!delayTimer.timerExpired())</div><div class="line">          {</div><div class="line">               <span class="comment">// --- advance timer</span></div><div class="line">               delayTimer.advanceTimer(processInfo.samplesToProcess);</div><div class="line"></div><div class="line">               <span class="comment">// --- just return the current value</span></div><div class="line">               <span class="keywordflow">return</span> outputValue;</div><div class="line">          }</div><div class="line"></div><div class="line">          <span class="comment">// --- check for completed 1-shot on this sample period</span></div><div class="line">          <span class="keywordtype">bool</span> bWrapped = lfoClock.wrapClock();</div><div class="line">          <span class="keywordflow">if</span> (bWrapped &amp;&amp; parameters-&gt;modeIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOMode::kOneShot))</div><div class="line">          {</div><div class="line">               renderComplete = <span class="keyword">true</span>;</div><div class="line">               outputValue = 0.0;</div><div class="line">               <span class="keywordflow">return</span> renderComplete;</div><div class="line">          }</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>The next chunk of code is a big decision-tree, based on the user's selection for the parameters-&gt;waveformIndex value and you can see the user of the strongly typed enum.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (parameters-&gt;waveformIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOWaveform::kSin))</div><div class="line">{</div><div class="line">     <span class="comment">// --- calculate normal angle</span></div><div class="line">     <span class="keywordtype">double</span> angle = lfoClock.mcounter*<a class="code" href="group___constants-_enums.html#gace28ec43173c74c9367e11c73315e09c">kTwoPi</a> - <a class="code" href="group___constants-_enums.html#ga356efafabc82ea087ea04ab333668ffa">kPi</a>;</div><div class="line">     <span class="keywordtype">double</span> sine = <a class="code" href="group___synth_functions.html#ga837b744b9a4cf5338912bad065d7aa4d">parabolicSine</a>(-angle);</div><div class="line">     outputValue = sine;</div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters-&gt;waveformIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOWaveform::kTriangle))</div><div class="line">{</div><div class="line">     outputValue = 1.0 - 2.0*fabs(<a class="code" href="group___modulation_functions.html#gac2b287703e190c8b22b2a9c5f461802a">bipolar</a>(lfoClock.mcounter));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// etc...</span></div></div><!-- fragment --><p><b>Add the New Code</b> <br />
 Our clipped sinusoid is going to be very naive in design; we will use the trig function sin() to generate the sinusoid and learn about the SynthClock in the process. Please do not send me hate-mail or toxic forum posts about calling the sin( ) function &ndash; this is just a tutorial. Later, you can exchange this for one of the sinusoidal approximation functions from the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> if you like. The SyntClock is a modulo counter. The count variable is named <b>mcounter</b> and you can access it directly; it is used so frequently that I didn't want to waste CPU cycles to call a getter function on a protected member. You may certainly change this if it disturbs you; the class definition is in the <a class="el" href="synthbase_8h.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">synthbase.h</a> file. <br />
</p>
<p>The modulo counter will count from 0.0 to 1.0 and rollover. The trig function sin() takes its argument in radians on the range of [-pi, +pi] or [0, 2pi]. Our code will:</p><ul>
<li>take the modulo counter value and multiply it by 2pi to generate the argument for the sin() function</li>
<li>multiply the outut of the sin() function by 1.25 to amplify it</li>
<li>use the <a class="el" href="group___synth_functions.html#gab5397b0e177e87c615ead68e8d0a3e9c" title="Bound a value to min and max limits. ">boundValue()</a> function to clip the waveform at [-1.0, +1.0]</li>
</ul>
<p>We know that the waveform index for our new LFO wave is 10 so we can just modify the decision tree directly (you can always add a new value to the enumeration if you like):</p>
<div class="fragment"><div class="line"><span class="comment">// --- calculate the oscillator value</span></div><div class="line"><span class="keywordflow">if</span> (parameters-&gt;waveformIndex == 10)</div><div class="line">{</div><div class="line">     <span class="comment">// --- calculate normal angle</span></div><div class="line">     <span class="keywordtype">double</span> angle = lfoClock.mcounter*<a class="code" href="group___constants-_enums.html#gace28ec43173c74c9367e11c73315e09c">kTwoPi</a>; <span class="comment">// scale by 2pi</span></div><div class="line">     <span class="keywordtype">double</span> sine = 1.25 * sin(angle);         <span class="comment">// amplify by 1.25</span></div><div class="line">     <a class="code" href="group___synth_functions.html#gab5397b0e177e87c615ead68e8d0a3e9c">boundValue</a>(sine, -1.0, +1.0);            <span class="comment">// clip</span></div><div class="line">     outputValue = sine;                      <span class="comment">// set output variable</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters-&gt;waveformIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOWaveform::kSin))</div><div class="line">{</div><div class="line">     <span class="comment">// --- calculate normal angle</span></div><div class="line">     <span class="keywordtype">double</span> angle = lfoClock.mcounter*<a class="code" href="group___constants-_enums.html#gace28ec43173c74c9367e11c73315e09c">kTwoPi</a> - <a class="code" href="group___constants-_enums.html#ga356efafabc82ea087ea04ab333668ffa">kPi</a>;</div><div class="line">     <span class="keywordtype">double</span> sine = <a class="code" href="group___synth_functions.html#ga837b744b9a4cf5338912bad065d7aa4d">parabolicSine</a>(-angle);</div><div class="line">     outputValue = sine;</div><div class="line">}</div><div class="line"></div><div class="line">etc...</div></div><!-- fragment --><p>The last part of the render operation first runs some modifiers on the waveform, one for step quantization and the other for shape and then fashions the variations on the waveforms and plants them into their pre-assigned slots in the modulation output array. Here are the modifications; notice the source of the modifiers, one is a direct parameter member, and the other is a parameter mod knob.</p>
<div class="fragment"><div class="line">     <span class="comment">// --- quantizer (stepper)</span></div><div class="line">     <span class="keywordflow">if</span> (parameters-&gt;quantize &gt; 0)</div><div class="line">          outputValue = <a class="code" href="group___synth_functions.html#gace53655b3d735073f881fd156f833c18">quantizeBipolarValue</a>(outputValue, parameters-&gt;quantize);</div><div class="line"></div><div class="line">     outputValue = <a class="code" href="group___synth_functions.html#gace53655b3d735073f881fd156f833c18">quantizeBipolarValue</a>(outputValue, pow(2.0, 10));</div><div class="line"></div><div class="line">     <span class="comment">// --- scale by amplitude</span></div><div class="line">     outputValue *= parameters-&gt;outputAmplitude;</div><div class="line"></div><div class="line">     <span class="comment">// --- SHAPE --- //</span></div><div class="line">     <span class="keywordtype">double</span> shape = <a class="code" href="group___synth_functions.html#ga69fddc8a8a4c490560530b630e945046">getModKnobValueLinear</a>(parameters-&gt;modKnobValue[MOD_KNOB_A], 0.0, 1.0);</div><div class="line">     <span class="keywordtype">double</span> shapeOut = 0.0;</div><div class="line">     <span class="keywordflow">if</span> (shape &gt;= 0.5)</div><div class="line">          shapeOut = <a class="code" href="group___synth_functions.html#gad820a9f3ef3c19a8954569472332d316">bipolarConvexXForm</a>(outputValue);</div><div class="line">     <span class="keywordflow">else</span></div><div class="line">          shapeOut = <a class="code" href="group___synth_functions.html#gab5fce6493c088ea77f9e0b2e3e39f891">bipolarConcaveXForm</a>(outputValue);</div><div class="line"></div><div class="line">     <span class="comment">// --- split bipolar for multiplier</span></div><div class="line">     shape = <a class="code" href="group___modulation_functions.html#gae66458b9a7ea085e3c64c37f4405a555">splitBipolar</a>(shape);</div><div class="line">     outputValue = shape*shapeOut + (1.0 - shape)*outputValue;</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>The modulation output array slots are indexed with an enum that is defined just before the LFOParameters structure (you will notice the same pattern with the rest of the modulation sources). The SynthLab LFO objects output four different values; a normal output plus a -180 degree inverted variation and two unipolar outputs (see the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a> for details).</p>
<div class="fragment"><div class="line"><span class="comment">// --- array locations in mod output</span></div><div class="line"><span class="keyword">enum</span> {</div><div class="line">     kLFONormalOutput,</div><div class="line">     kLFOInvertedOutput,</div><div class="line">     kUnipolarFromMin,</div><div class="line">     kUnipolarFromMax,</div><div class="line">     kNumLFOOutputs</div><div class="line">};</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>Here is the last bit of code. Rememeber that we are in a loop, processing a block of rendered output data. Notice how we only write an output on the first sample in the block. This is because SynthLab uses block audio processing and granulized modulator values (see <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>). You can always force the system to process samples rather than blocks by setting the blocksize variable to 1.</p>
<div class="fragment"><div class="line">          <span class="comment">// --- set outputs: either write first output or last in block</span></div><div class="line">          <span class="comment">//</span></div><div class="line">          <span class="comment">// --- first output sample only:</span></div><div class="line">          <span class="keywordflow">if</span> (i == 0)</div><div class="line">          {</div><div class="line">               processInfo.modulationOutputs-&gt;setModValue(kLFONormalOutput, outputValue);</div><div class="line">               processInfo.modulationOutputs-&gt;setModValue(kLFOInvertedOutput, -outputValue);</div><div class="line">     </div><div class="line">               <span class="comment">// --- special unipolar from max output for tremolo</span></div><div class="line">               <span class="comment">//</span></div><div class="line">               <span class="comment">// --- first, convert to unipolar</span></div><div class="line">               processInfo.modulationOutputs-&gt;setModValue(kUnipolarFromMax, <a class="code" href="group___modulation_functions.html#gac2b287703e190c8b22b2a9c5f461802a">bipolar</a>(outputValue));</div><div class="line">               processInfo.modulationOutputs-&gt;setModValue(kUnipolarFromMin, <a class="code" href="group___modulation_functions.html#gac2b287703e190c8b22b2a9c5f461802a">bipolar</a>(outputValue));</div><div class="line">     </div><div class="line">               <span class="comment">// --- then shift upwards by enough to put peaks right at 1.0</span></div><div class="line">               processInfo.modulationOutputs-&gt;setModValue(kUnipolarFromMax, </div><div class="line">                           processInfo.modulationOutputs-&gt;getModValue(kUnipolarFromMax) + (0.5 - (parameters-&gt;outputAmplitude / 2.0)));</div><div class="line">     </div><div class="line">               <span class="comment">// --- then shift down enough to put troughs at 0.0</span></div><div class="line">               processInfo.modulationOutputs-&gt;setModValue(kUnipolarFromMin, </div><div class="line">                           processInfo.modulationOutputs-&gt;getModValue(kUnipolarFromMin) - (0.5 - (parameters-&gt;outputAmplitude / 2.0)));</div><div class="line">          }</div><div class="line"></div><div class="line">          <span class="comment">// --- NOTE: inside the loop, advance by 1</span></div><div class="line">          lfoClock.advanceClock();</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">     </div><div class="line">} <span class="comment">// end of render()</span></div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p><b>doNoteOn( ) and doNoteOff</b> <br />
 Here are the two MIDI note event handlers. There is nothing for us to change in these functions but you should still check them out because you'll be writing your own soon. The large majority of ModuleCores have empty note-off handlers as there is usually nothing to do; resetting most objects will be redundant with the note-on function.</p>
<div class="fragment"><div class="line"><span class="comment">// --- note on handler</span></div><div class="line"><span class="keywordtype">bool</span> LFOCore::doNoteOn(CoreProcData&amp; processInfo)</div><div class="line">{</div><div class="line">     <span class="comment">// --- parameters</span></div><div class="line">     LFOParameters* parameters = <span class="keyword">static_cast&lt;</span>LFOParameters*<span class="keyword">&gt;</span>(processInfo.moduleParameters);</div><div class="line"></div><div class="line">     renderComplete = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">     <span class="keywordflow">if</span> (parameters-&gt;modeIndex != <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOMode::kFreeRun))</div><div class="line">     {</div><div class="line">     lfoClock.reset();</div><div class="line">     sampleHoldTimer.resetTimer();</div><div class="line">     </div><div class="line">     outputValue = 0.0;</div><div class="line">     rshOutputValue = noiseGen.doWhiteNoise();</div><div class="line">     </div><div class="line">     delayTimer.resetTimer();</div><div class="line">     <span class="keywordtype">double</span> delay_mSec = <a class="code" href="group___synth_functions.html#ga69fddc8a8a4c490560530b630e945046">getModKnobValueLinear</a>(parameters-&gt;modKnobValue[LFO_DELAY], 0.0, MAX_LFO_DELAY_MSEC);</div><div class="line">     delayTimer.setExpireSamples(<a class="code" href="group___synth_functions.html#gadd302e8ca73d6fc585b6af273f5213e5">msecToSamples</a>(sampleRate, delay_mSec));</div><div class="line">     </div><div class="line">     <span class="keywordtype">double</span> fadeIn_mSec = <a class="code" href="group___synth_functions.html#ga69fddc8a8a4c490560530b630e945046">getModKnobValueLinear</a>(parameters-&gt;modKnobValue[LFO_FADE_IN], 0.0, MAX_LFO_FADEIN_MSEC);</div><div class="line">     fadeInModulator.startModulator(0.0, 1.0, fadeIn_mSec, processInfo.sampleRate);</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="keywordflow">if</span> (parameters-&gt;waveformIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOWaveform::kTriangle))</div><div class="line">     lfoClock.addPhaseOffset(0.25);</div><div class="line">     </div><div class="line">     <span class="keywordflow">if</span> (parameters-&gt;waveformIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOWaveform::kRampUp) || parameters-&gt;waveformIndex == <a class="code" href="group___constants-_enums.html#gafe6b97a9f03775e21060ed411465d1a6">enumToInt</a>(LFOWaveform::kRampDown))</div><div class="line">     lfoClock.addPhaseOffset(0.5);</div><div class="line">     </div><div class="line">     <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// --- note off handler is empty</span></div><div class="line"><span class="keywordtype">bool</span> LFOCore::doNoteOff(CoreProcData&amp; processInfo)</div><div class="line">{</div><div class="line">     <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>Now, you can test the new object in your MinSynth C++ object and check to make sure you are getting the clipped output. The waveform here was taken from the output of the LFO; a trick I use all the time to test LFOs is to run them at audio frequencies and pipe their data out to the oscilloscope in RackAFX.</p>
<p><br />
 </p><div class="image">
<img src="clipsine.png" alt="clipsine.png"/>
</div>
<p> <br />
</p>
<p>Next, we will create a new ModuleCore from scratch to implement a pitched oscillator based on the same trig function calls.</p>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="module_cores.html">ModuleCore Progamming</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
