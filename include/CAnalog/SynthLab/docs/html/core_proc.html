<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: The CoreProcData Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('core_proc.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The CoreProcData Structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Look at the class definition for th ModuleCore to find the five functions that implement the five operational phases of all sytnth components. All functions take the same argument, a reference to a CoreProcData structure. The owning SynthModule prepares this structure in its constructor, and passes it to the cores when it calls their functions. </p><div class="fragment"><div class="line"><span class="comment">// abstract base class functions: see my synth book for theory details</span></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> reset(CoreProcData&amp; processInfo) = 0;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> update(CoreProcData&amp; processInfo) = 0;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> render(CoreProcData&amp; processInfo) = 0;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> doNoteOn(CoreProcData&amp; processInfo) = 0;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> doNoteOff(CoreProcData&amp; processInfo) = 0;</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>This structure is different from the others in SynthLab as it uses naked pointers (rather than std::unique_ptr and std::shared_ptr) and const char*s (rather than std::string). There is a very important reason for using these old-fashioned constructs: for dynamically loaded ModuleCores (mini-DLLs) this structure will be passed across the thunk layer, an imaginary barrier between the process and the DLL with which it communicates. This absolutely requires using these basic C++ datatypes while avoiding the standard library (in addition to many others) and has to do with the way functions are called and the stack is pushed/popped. The standard library's binaries are different for every version of Visual Studio and Xcode, and are also different for the Debug and Release configurations. This would break the whole idea of compiling the mini-DLLs in whatever version of Visual Studio or Xcode you choose. <br />
</p>
<p>The CoreProcData structure contains every piece of information that will be needed for any and all of the five operational phases. The structure is shown below and most of the parameters are self-explanatory based on the name. First are the modulation input and output array pointers:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>CoreProcData</div><div class="line">{</div><div class="line">     <span class="comment">// --- Interfaces to modulation arrays </span></div><div class="line">     IModulator* modulationInputs = <span class="keyword">nullptr</span>; <span class="comment">//&lt; input modulation values</span></div><div class="line">     IModulator* modulationOutputs = <span class="keyword">nullptr</span>;<span class="comment">//&lt; output modulation values</span></div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>Next are the naked pointers to the audio buffers; the pointers are arrays of pointers as each channel has its own buffer. The fmBuffer contains audio data that is used for phase modulation (FM synthesis).</p>
<div class="fragment"><div class="line"><span class="comment">// --- old fashioned (naked) pointers can survive the thunk-barrier </span></div><div class="line"><span class="keywordtype">float</span>** inputBuffers = <span class="keyword">nullptr</span>;    <span class="comment">//&lt; set of input bufers, one per channel</span></div><div class="line"><span class="keywordtype">float</span>** outputBuffers = <span class="keyword">nullptr</span>;   <span class="comment">//&lt; set of output bufers, one per channel</span></div><div class="line"><span class="keywordtype">float</span>** fmBuffers = <span class="keyword">nullptr</span>;       <span class="comment">//&lt; used for DX synths (phase modulator synths)</span></div></div><!-- fragment --><p>To get a pointer to the left channel input buffer during the render() operation you would write:</p>
<div class="fragment"><div class="line">bool &lt;SynthModule&gt;:render(CoreProcData&amp; processInfo)</div><div class="line">{</div><div class="line">     <span class="comment">// --- get pointer to the left buffer</span></div><div class="line">     <span class="keywordtype">float</span>* leftInBuffer = processInfo.inputBuffers[LEFT_CHANNEL];  </div><div class="line">     <span class="comment">//</span></div></div><!-- fragment --><p>Next are the database and MIDI input data pointers (the interfaces are likewise "pure" C++ with no std:: library members)</p>
<div class="fragment"><div class="line"><span class="comment">// --- Pointers to shared resources </span></div><div class="line">IWavetableDatabase* wavetableDatabase = <span class="keyword">nullptr</span>;  <span class="comment">//&lt; wavetable database, usually owned by engine</span></div><div class="line">IPCMSampleDatabase* sampleDatabase = <span class="keyword">nullptr</span>;     <span class="comment">//&lt; PCM sample database, usually owned by engine</span></div><div class="line">IMidiInputData* midiInputData = <span class="keyword">nullptr</span>;          <span class="comment">//&lt; MIDI input daa, usually owned by engine</span></div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>The next member is so important, it has its own code listing. This is the custom data structure pointer. This pointer is cloaked as a void* since it will depend on the type of module.</p>
<div class="fragment"><div class="line"><span class="comment">// --- the all-important parameters!</span></div><div class="line"><span class="keywordtype">void</span>* moduleParameters = <span class="keyword">nullptr</span>; <span class="comment">// module parameters, cloaked as void* -- varies according to module</span></div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>You cast this pointer to the datatype you need for a particular module. You can use simple casting or more complex versions, checking the cast before usage. Here I will just use a simple cast:</p>
<div class="fragment"><div class="line"><span class="comment">// --- parameters from void*</span></div><div class="line">LFOParameters* parameters = <span class="keyword">static_cast&lt;</span>LFOParameters*<span class="keyword">&gt;</span>(processInfo.moduleParameters);</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>The remaining members are used in various operational phases. Note the MIDINoteEvent structure that is used for the note-on and note-off handlers.</p>
<div class="fragment"><div class="line">     <span class="keyword">const</span> <span class="keywordtype">char</span>* dllPath = <span class="keyword">nullptr</span>;     <span class="comment">//&lt; path to the plugin, used for finding PCM sample WAV files</span></div><div class="line"></div><div class="line">     <span class="keywordtype">double</span> sampleRate = 0.0;           <span class="comment">//&lt; fs</span></div><div class="line">     uint32_t samplesToProcess = 64;    <span class="comment">//&lt; number of samples in this block</span></div><div class="line">     <span class="keywordtype">double</span> unisonDetuneCents = 0.0;     <span class="comment">//&lt; detuning value for this core</span></div><div class="line">     <span class="keywordtype">double</span> unisonStartPhase = 0.0;     <span class="comment">//&lt; unison start phase value for this core</span></div><div class="line"></div><div class="line">     <span class="keywordtype">double</span> BPM = 120.0;        <span class="comment">//&lt; current BPM, needed for LFO sync to BPM</span></div><div class="line">     MIDINoteEvent noteEvent;   <span class="comment">//&lt; the MIDI note event for the current audio block</span></div><div class="line">};</div></div><!-- fragment --><p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="module_cores.html">ModuleCore Progamming</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
