<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: SynthFilter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ex_filter.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SynthFilter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b><a class="el" href="class_synth_lab_1_1_synth_filter.html" title="Synthesizer filter module. ">SynthLab::SynthFilter</a></b> object processes audio samples from its AudioBuffer input array to its AudioBuffer output array. It also reads its modulation input array during the update( ) phase to allow parameter modulation.</p>
<p>You will need to add the following files for the SynthFilter</p><ul>
<li><a class="el" href="synthfilter_8h.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">synthfilter.h</a> and <a class="el" href="synthfilter_8cpp.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">synthfilter.cpp</a></li>
<li><a class="el" href="bqfiltercore_8h.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">bqfiltercore.h</a> and <a class="el" href="bqfiltercore_8cpp.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">bqfiltercore.cpp</a></li>
<li><a class="el" href="vafiltercore_8h.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">vafiltercore.h</a> and <a class="el" href="vafiltercore_8cpp.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">vafiltercore.cpp</a></li>
<li><a class="el" href="vafilters_8h.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">vafilters.h</a> and <a class="el" href="vafilters_8cpp.html" title="See also Designing Software Synthesizers in C++ 2nd Ed. by Will Pirkle. ">vafilters.cpp</a></li>
</ul>
<p>Follow the same pattern and start with the class documentation. The SynthFilter:</p>
<ul>
<li>uses a FilterParameters structure for control, both GUI and programatically</li>
<li>reads values from its own AudioBuffer input</li>
<li>renders values into its own AudioBuffer output</li>
<li>includes 2 filter cores, virtual analog and biquad</li>
</ul>
<p>We'll choose the VACore object (index = 0, see docs for SynthFilter class) and jump to its documentation. There we can find the module strings and mod knob assignments. The ModuleStrings are the two implemented filter types. We'll choose the 2nd order state-variable lowpass filter (SVFLPF2)</p>
<p>Module Strings, zero-indexed for your GUI Control:</p><ul>
<li>No_Filter, LPF1, HPF1, APF1, SVF_LP, SVF_HP, SVF_BP, SVF_BS, Korg35_LP, Korg35_HP, Moog_LP1, Moog_LP2, Moog_LP3, Moog_LP4, Diode_LP4</li>
</ul>
<p>We will choose the SVF_LP, which as a zero-indexed string entry is [4]. Next, look at the documentation to find the output data (render) location <br />
</p>
<p>From the docs on VAFilterCore:</p><ul>
<li>reads from the input buffer</li>
<li>renders into the output buffer</li>
<li>renders one block of audio per render cycle</li>
</ul>
<h2>Processing AudioBuffers </h2>
<p>The SynthFilter processes audio samples rather than rendering them. For the sample code here, we are going to use the wavetable oscillator's output buffer as input samples for the filter. To do this, you will use a helper function form <a class="el" href="synthfunctions_8h.html" title="hard-coded arrays of FIR filter coefficients for the sample rate conversion objects (Interpolator and...">synthfunctions.h</a> that does fast memcpy( ) operations on bulk memory chunks to transfer the audio data from the oscillator output to the filter input. These functions take the following channel count constants:</p><ul>
<li><b>MONO_TO_MONO</b>: left channel to left channel</li>
<li><b>MONO_TO_STEREO</b>: left channel to left and right channels (dual mono)</li>
<li><b>STEREO_TO_STEREO</b>: left to left and right to right channels</li>
</ul>
<p>They use the following constants that you can also use for your buffer access code for better readability:</p><ul>
<li><b>LEFT_CHANNEL</b>: array slot [0] in the buffer</li>
<li><b>RIGHT_CHANNEL</b>: array slot [1] in the buffer</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// --- one of several buffer copy functions</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___synth_functions.html#ga7edcac97d707b99911e4cd6dd4a87efb">copyOutputToInput</a>(std::shared_ptr&lt;AudioBuffer&gt; source,      <span class="comment">/* the AudioBuffer output */</span></div><div class="line">                       std::shared_ptr&lt;AudioBuffer&gt; destination, <span class="comment">/* the AudioBuffer input */</span></div><div class="line">                       uint32_t channel,                          <span class="comment">/* channel code */</span></div><div class="line">                       uint32_t samplesToCopy)                    <span class="comment">/* size of copy*/</span></div><div class="line"><span class="comment">// </span></div></div><!-- fragment --><p>There are more of these fast-copy helper functions:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Copies Block   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">copyOutputToInput  </td><td class="markdownTableBodyNone">from an AudioBuffer output to an AudioBuffer input   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">copyInputToOutput  </td><td class="markdownTableBodyNone">from an AudioBuffer input to an AudioBuffer output   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">copyOutputToOutput  </td><td class="markdownTableBodyNone">from an AudioBuffer output to an AudioBuffer output   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">copyOutputToOutput  </td><td class="markdownTableBodyNone">from an AudioBuffer output to a SynthProcessInfo output (see SynthVoice)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">copyAudioBufferOutputToSynthOutput  </td><td class="markdownTableBodyNone">from an AudioBuffer output to a SynthProcessInfo output (see SynthEngine)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">copyBufferToInput  </td><td class="markdownTableBodyNone">same as copyOutputToInput, used with mix buffers and other temporary buffers   </td></tr>
</table>
<p>Note that the SynthFilter documentation also shows you how to create the object in standalone mode, we can use this code verbatim because we will setup a blocksize of 64 for this filter.</p>
<div class="fragment"><div class="line"><span class="comment">// --- standalone construction, block size = 64</span></div><div class="line">SynthFilter(<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 64);</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>So, we will do the following:</p><ol type="1">
<li>create the filter and pass nullptr for the MIDI input and parameters arguments</li>
<li>reset it with the sample rate</li>
<li>select the VAFilterCore (index = 0 &ndash; it is the default)</li>
<li>create a MIDI event and call the note-on handler</li>
<li>use getParameters: set the filter to SVF LP ([4], set the filter fc = 880.0 Hz and Q = 5.0, output amplitude = +2.0 dB</li>
<li>transfer audio from the wavetable oscillator (in the previous section) to the filter</li>
<li>call the render function to process the data (send that to your plugin framework output buffer)</li>
<li>call the note-off handler when note event is done</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="synthfilter_8h.html">synthfilter.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// --- create a LFO via shared pointer; here is the definition</span></div><div class="line">std::unique_ptr&lt;SynthLab::SynthFilter&gt; filter = <span class="keyword">nullptr</span>;</div><div class="line"></div><div class="line"><span class="comment">// --- here is the creation</span></div><div class="line">filter.reset(<span class="keyword">new</span> <a class="code" href="class_synth_lab_1_1_synth_filter.html">SynthLab::SynthFilter</a>(<span class="keyword">nullptr</span>,  <span class="comment">/* MIDI input data */</span></div><div class="line">                                       <span class="keyword">nullptr</span>,  <span class="comment">/* filter parameters */</span></div><div class="line">                                       64));     <span class="comment">/* block size */</span></div><div class="line"></div><div class="line"><span class="comment">// --- initialize</span></div><div class="line">filter-&gt;reset(44100.0); <span class="comment">//&lt;- get fs from your framework</span></div><div class="line"></div><div class="line"><span class="comment">// --- select core #0: VA Filter core (no harm in selecting it, we know it is default)</span></div><div class="line">filter-&gt;selectModuleCore(0);</div><div class="line"></div><div class="line"><span class="comment">// --- get the parameter struct pointer; </span></div><div class="line"><span class="comment">//     it was synthesized when we passed a nullptr into the constructor</span></div><div class="line">std::shared_ptr&lt;SynthLab::FilterParameters&gt; filterParameters = filter-&gt;getParameters();</div><div class="line"><span class="keywordflow">if</span> (filterParameters) <span class="comment">// should never fail</span></div><div class="line">{</div><div class="line">    <span class="comment">// --- set the variables</span></div><div class="line">    filterParameters-&gt;filterIndex = 4; <span class="comment">// SVF LP</span></div><div class="line">    filterParameters-&gt;fc = 880.0;</div><div class="line">    filterParameters-&gt;Q = 5;</div><div class="line">    filterParameters-&gt;filterOutputGain_dB = +2.0;</div><div class="line"></div><div class="line">    <span class="comment">// --- call the update function (only needs to be done once per render cycle)</span></div><div class="line">    filter-&gt;update();</div><div class="line">}</div><div class="line"><span class="comment">// ---</span></div></div><!-- fragment --><p>Now, in response to a MIDI note-on message, we setup a MIDIEvent structure (NOTE: we added the call to the pitch calculaton prior to the note-on function call):</p>
<div class="fragment"><div class="line"><span class="comment">// --- prepare a MIDI event for note-on</span></div><div class="line"><a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html">SynthLab::MIDINoteEvent</a> midiEvent;</div><div class="line">midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#ab39c1eb0f451972d37592e99636f8e06">midiNoteNumber</a> = 60;</div><div class="line">midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#a7c1a0e203aa66105e2f69d3f2850881d">midiPitch</a> = <a class="code" href="group___m_i_d_i_functions.html#gad3b90b92d9aa8104d1b4fa897b5db750">SynthLab::midiNoteNumberToOscFrequency</a>(midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#ab39c1eb0f451972d37592e99636f8e06">midiNoteNumber</a>); <span class="comment">//&lt; PITCH Calculation</span></div><div class="line">midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#a93dce735febfe26bc91a4b17922adec9">midiNoteVelocity</a> = 127;</div><div class="line"></div><div class="line"><span class="comment">// --- send note event</span></div><div class="line">wtOsc-&gt;doNoteOn(midiEvent);</div><div class="line"></div><div class="line"><span class="comment">// --- filter note on handler</span></div><div class="line">filter-&gt;doNoteOn(midiEvent);</div><div class="line"></div><div class="line"><span class="comment">// ---</span></div></div><!-- fragment --><p>Now you render values from the oscillator and send them to the filter. Once rendered, you may send the block of data to your plugin framework's output buffers;</p>
<div class="fragment"><div class="line"><span class="comment">// --- render OSC output</span></div><div class="line">wtOsc-&gt;render(64);</div><div class="line"></div><div class="line"><span class="comment">// --- transfer information from OSC output to filter input</span></div><div class="line"><a class="code" href="group___synth_functions.html#ga7edcac97d707b99911e4cd6dd4a87efb">SynthLab::copyOutputToInput</a>(wtOsc-&gt;getAudioBuffers(),   <span class="comment">/* FROM osc output */</span></div><div class="line">                            filter-&gt;getAudioBuffers(),  <span class="comment">/* TO filter input */</span></div><div class="line">                            SynthLab::STEREO_TO_STEREO, <span class="comment">/* stereo copy */</span></div><div class="line">                            64);                        <span class="comment">/* block size in frames */</span></div><div class="line"><span class="comment">// --- render the filter</span></div><div class="line">filter-&gt;render(64); <span class="comment">// blocksize is 64</span></div><div class="line"></div><div class="line"><span class="comment">// --- get pointers to output buffers</span></div><div class="line"><span class="keywordtype">float</span>* leftOutBuffer = filter-&gt;getAudioBuffer()-&gt;getOutputBuffer(SynthLab::LEFT_CHANNEL);</div><div class="line"><span class="keywordtype">float</span>* rightOutBuffer = filter-&gt;getAudioBuffer()-&gt;getOutputBuffer(SynthLab::RIGHT_CHANNEL);</div><div class="line"></div><div class="line"><span class="comment">// --- loop over buffers to access samples; loop maximum (64) set manually here</span></div><div class="line"><span class="keywordflow">for</span> (uint32_t i = 0; i &lt; 64; i++)</div><div class="line">{</div><div class="line">     <span class="keywordtype">float</span> leftSample = leftOutBuffer[i];</div><div class="line">     <span class="keywordtype">float</span> rightSample = rightOutBuffer[i];</div><div class="line">     </div><div class="line">     <span class="comment">// --- SEND THESE OUTPUTS TO YOUR FRAMEWORK or play with them</span></div><div class="line">}</div><div class="line"><span class="comment">// ---</span></div></div><!-- fragment --><p>From here you can keep rendering until the note-off message arrives.</p>
<div class="fragment"><div class="line"><span class="comment">// --- prepare a MIDI event for note-off</span></div><div class="line"><a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html">SynthLab::MIDINoteEvent</a> midiEvent;</div><div class="line">midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#ab39c1eb0f451972d37592e99636f8e06">midiNoteNumber</a> = 60;      <span class="comment">// &lt;- get from your framework</span></div><div class="line">midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#a7c1a0e203aa66105e2f69d3f2850881d">midiPitch</a> = <a class="code" href="group___m_i_d_i_functions.html#gad3b90b92d9aa8104d1b4fa897b5db750">SynthLab::midiNoteNumberToOscFrequency</a>(midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#ab39c1eb0f451972d37592e99636f8e06">midiNoteNumber</a>); <span class="comment">//&lt; PITCH Calculation</span></div><div class="line">midiEvent.<a class="code" href="struct_synth_lab_1_1_m_i_d_i_note_event.html#a93dce735febfe26bc91a4b17922adec9">midiNoteVelocity</a> = 0;     <span class="comment">// &lt;- get from your framework</span></div><div class="line"></div><div class="line"><span class="comment">// --- send note event</span></div><div class="line">filter-&gt;doNoteOff(midiEvent);</div><div class="line"><span class="comment">// ---</span></div></div><!-- fragment --><p>Now, experiment with changing the filter parameters (see the FilterParameter documentation to see what you can change). Also, try experimenting with the mod knobs (see SynthLFO tutorial above)</p>
<p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="standalone.html">Standalone Programming</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
