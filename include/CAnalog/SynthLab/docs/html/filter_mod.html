<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SynthLab SDK: Filter Cutoff Modulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynthLab SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('filter_mod.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Filter Cutoff Modulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are multiple sources of cutoff modulation built into the SynthLab example synths and detailed in the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>. Here is the update() function that implements this modulation; no other code needs to be modified. Note the use of key track, EG and bipolar modulation along with the necessary bounding function to make sure the cutoff frequency is within range. Notice how the modulation input array values are accessed for the bpFmodSemitones and egFmodSemitones variables.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> FilterModule::update()</div><div class="line">{</div><div class="line">     <span class="comment">// --- to be modulated</span></div><div class="line">     <span class="keywordtype">double</span> filterFc = parameters-&gt;fc;</div><div class="line"></div><div class="line">     <span class="comment">// --- bipolar freqmod (0.5 is to split the total range)</span></div><div class="line">     <span class="keywordtype">double</span> bpFmodSemitones = 0.5*freqModSemitoneRange * getModulationInput()-&gt;getModValue(kBipolarMod);</div><div class="line"></div><div class="line">     <span class="comment">// --- EG input here</span></div><div class="line">     <span class="keywordtype">double</span> egFmodSemitones = freqModSemitoneRange *  getModulationInput()-&gt;getModValue(kEGMod);</div><div class="line"></div><div class="line">     <span class="comment">// --- setup keytrack fc mod</span></div><div class="line">     <span class="keywordtype">double</span> ktFmodSemotones = 0.0;</div><div class="line"></div><div class="line">     <span class="comment">// --- key tracking</span></div><div class="line">     <span class="keywordflow">if</span> (parameters-&gt;enableKeyTrack)</div><div class="line">     {</div><div class="line">          <span class="comment">// --- key track amount</span></div><div class="line">          ktFmodSemotones = <a class="code" href="group___synth_functions.html#ga69fddc8a8a4c490560530b630e945046">getModKnobValueLinear</a>(parameters-&gt;modKnobValue[MOD_KNOB_A], -48.0, +48.0);</div><div class="line"></div><div class="line">          <span class="comment">// --- overwrite fc</span></div><div class="line">          filterFc = midiPitch;</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="comment">// --- sum modulations</span></div><div class="line">     <span class="keywordtype">double</span> fcModSSemis = bpFmodSemitones + egFmodSemitones + ktFmodSemotones;</div><div class="line"></div><div class="line">     <span class="comment">// --- multiply by pitch shift factor</span></div><div class="line">     filterFc *= pow(2.0, fcModSSemis / 12.0);</div><div class="line">     <a class="code" href="group___synth_functions.html#gab5397b0e177e87c615ead68e8d0a3e9c">boundValue</a>(filterFc, <a class="code" href="group___constants-_enums.html#gaa4acc0ac6750a700bfc8a97b6cdc52b2">freqModLow</a>, freqModHigh);</div><div class="line"></div><div class="line">     <span class="comment">// --- setup biquad structures and load with coefficients depending on filter type</span></div><div class="line">     <span class="keywordflow">if</span> (parameters-&gt;filterIndex == vicLPF2)</div><div class="line">     {</div><div class="line">          -- Rest of <span class="keyword">function</span> is identical from <span class="keyword">this</span> point onward...</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p><b>Testing the Modulation</b> <br />
 Notice how the EG and bipolar modulation values are parsed and used in the update equation (the theory is in the <a href="https://www.routledge.com/Designing-Software-Synthesizer-Plugins-in-C-With-Audio-DSP/Pirkle/p/book/9780367510466" target="_blank">synth book</a>). For testing, we can either manipulate those values directly or connect the filter to the LFO the way you did in the MinSynth voice object. We will manipulate them directly here. An easy place to do this is in the code for updating the filter. Start with the modulators at 0.0 each before trying different values. The modulation code does not include the intensity control so they are technically running at 100% (1.0). When you adjust either of the modulation values a bit, there will be a large swing in the new cutoff frequency. Set a breakpoint in the calculation to watch this happen. Note that the filter's fc can go right up to the Nyquist frequency so if using the bandpass filter, you may hear nothing if the center frequency is outside the bounds of the oscillator's spectrum.</p>
<div class="fragment"><div class="line"><span class="comment">// --- get parameters</span></div><div class="line">std::shared_ptr&lt;SynthLab::FilterParameters&gt; filterModuleParameters = filterModule-&gt;getParameters();</div><div class="line"><span class="keywordflow">if</span> (filterModuleParameters) <span class="comment">// should never fail</span></div><div class="line">{</div><div class="line">     <span class="comment">// --- set the variable</span></div><div class="line">     filterModuleParameters-&gt;filterIndex = 1; <span class="comment">// LPF2</span></div><div class="line">     filterModuleParameters-&gt;fc = 500.0;</div><div class="line">     filterModuleParameters-&gt;Q = 20.0;</div><div class="line"></div><div class="line">     <span class="comment">// --- set modulation values</span></div><div class="line">     filterModule-&gt;getModulationInput()-&gt;setModValue(SynthLab::kEGMod, 0.0);</div><div class="line">     filterModule-&gt;getModulationInput()-&gt;setModValue(SynthLab::kBipolarMod, 0.0);</div><div class="line">     </div><div class="line">     <span class="comment">// --- update phase</span></div><div class="line">     filterModule-&gt;update();</div><div class="line">}</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p><br />
 </p><div class="image">
<img src="synthlab_4.png" alt="synthlab_4.png"/>
</div>
<p> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">SynthLab Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="synth_modules.html">SynthModule Progamming</a></li><li class="navelem"><a class="el" href="create_filter.html">Create a Filter Module</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
